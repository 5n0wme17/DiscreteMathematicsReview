# Hulec17 - 关系闭包与等价关系

## 二元关系

设 A = {a₁, a₂, ..., aₘ} 和 B = {b₁, b₂, ..., bₙ}，笛卡尔积 A × B 是成对的集合
{(a₁, b₁), (a₂, b₂), ..., (a₁, bₙ), ..., (aₘ, bₙ)}

**定义**: 设 A 和 B 是两个集合。从 A 到 B 的二元关系是笛卡尔积 A × B 的子集。
设 R ⊆ A × B 表示 R 是形式为 (a, b) 的有序对的集合，其中 a ∈ A 且 b ∈ B。

**定义**: 集合 A 上的关系是从 A 到自身的关系。

## 关系的性质

**自反关系**: 集合 A 上的关系 R 称为自反的，如果对于每个元素 a ∈ A，都有 (a,a) ∈ R。

**反自反关系**: 集合 A 上的关系 R 称为反自反的，如果对于每个元素 a ∈ A，都有 (a,a) ∉ R。

**对称关系**: 集合 A 上的关系 R 称为对称的，如果对于所有 a,b ∈ A，只要 (a,b) ∈ R，就有 (b,a) ∈ R。

**反对称关系**: 集合 A 上的关系 R 称为反对称的，如果对于所有 a,b ∈ A，(b,a) ∈ R 且 (a,b) ∈ R 蕴含 a = b。

**传递关系**: 集合 A 上的关系 R 称为传递的，如果对于所有 a,b,c ∈ A，(a,b) ∈ R 且 (b,c) ∈ R 蕴含 (a,c) ∈ R。

## 关系的组合

**定义**: 设 R 是从集合 A 到集合 B 的关系，S 是从 B 到 C 的关系。R 和 S 的组合是由有序对 (a,c) 组成的关系，其中 a ∈ A 且 c ∈ C，并且存在 b ∈ B 使得 (a,b) ∈ R 且 (b,c) ∈ S。我们用 S ∘ R 表示 R 和 S 的组合。

## R 的幂

**定义** 设 R 是集合 A 上的关系。R 的幂定义为：
R¹ = R 且 Rⁿ⁺¹ = Rⁿ ∘ R

**定理** 集合 A 上的关系 R 是传递的当且仅当对于 n = 1,2,3,...，有 Rⁿ ⊆ R

## 表示关系

表示 n 元关系的一些方法：
- 使用其元组的显式列表或表格
- 使用从定义域到 {T,F} 的函数

表示二元关系的一些特殊方法：
- 使用零一矩阵
- 使用有向图

## 关系的闭包

设 R = {(1,1), (1,2), (2,1), (3,2)} 在 A = {1,2,3} 上。
这个关系 R 是自反的吗？ ✗ 为什么？(2,2) 和 (3,3) 不在 R 中。

问题是什么是包含 R 的最小自反关系 S？

如何通过最少的添加使 R 自反？
添加 (2,2) 和 (3,3)
那么 S = {(1,1), (1,2), (2,1), (3,2), (2,2), (3,3)} ⊇ R

包含 R 的最小集合 S 称为 R 的自反闭包。

## 自反闭包

集合 S 称为 R 的自反闭包，如果它：
- 包含 R
- 是自反的
- 是最小的（包含在包含 R 的每个自反关系 Q 中，即 S ⊆ Q）

## 关系上的闭包

关系可以有不同的性质：
- 自反
- 对称
- 传递

我们定义：
- 自反闭包
- 对称闭包
- 传递闭包

## 闭包

**定义** 设 R 是集合 A 上的关系。具有性质 P 的关系 S 称为 R 关于 P 的闭包，如果 S 是包含 R 的每个具有性质 P 的关系 Q 的子集（S ⊆ Q）。

S 是包含 R 并满足性质 P 的最小集合。

**示例**: (对称闭包) R = {(1,2), (1,3), (2,2)} 在 A = {1,2,3} 上
R 的对称闭包 S 是什么？
S = {(1,2), (1,3), (2,2)} ∪ {(2,1), (3,1)}

## 闭包

**定义** 设 R 是集合 A 上的关系。具有性质 P 的关系 S 称为 R 关于 P 的闭包，如果 S 是包含 R 的每个具有性质 P 的关系 Q 的子集（S ⊆ Q）。

S 是包含 R 并满足性质 P 的最小集合。

**示例**: (传递闭包) R = {(1,2), (2,2), (2,3)} 在 A = {1,2,3} 上
R 是传递的吗？ ✗
如何使其传递？
S = {(1,2), (2,2), (2,3)} ∪ {(1,3)}

## 传递闭包

我们可以在图上表示关系。
找到传递闭包对应于找到通过有向路径连接的所有元素对

**示例**: R = {(1,2), (2,2), (2,3)} 在 A = {1,2,3} 上
传递闭包: S = {(1,2), (2,2), (2,3), (1,3)}

## 传递闭包

我们可以在图上表示关系。
找到传递闭包对应于找到通过有向路径连接的所有元素对

**示例**: R = {(1,2), (2,2), (2,3)} 在 A = {1,2,3} 上
传递闭包: S = {(1,2), (2,2), (2,3), (1,3)}

## 有向图中的路径

**定义** 有向图 G 中从 a 到 b 的路径是 G 中的边序列 (x₀,x₁), (x₁,x₂), ..., (xₙ₋₁,xₙ)，其中 n 是非负的且 x₀ = a 且 xₙ = b。开始和结束于同一顶点的长度为 n-1 的路径称为回路或循环。

**定理** 设 R 是集合 A 上的关系。存在从 a 到 b 的长度为 n 的路径当且仅当 (a,b) ∈ Rⁿ。

**证明** (通过归纳法)

## 连通性关系

**定义** 设 R 是集合 A 上的关系。连通性关系 R* 由所有对 (a,b) 组成，使得在 R 中存在从 a 到 b 的路径（任意长度）。
R* = ⋃ₖ₌₁∞ Rᵏ

**示例**: A = {1,2,3,4} R = {(1,2), (1,4), (2,3), (3,4)}
R² = {(1,3), (2,4)}
R³ = {(1,4)}
R⁴ = ∅
R* = {(1,2), (1,3), (1,4), (2,3), (2,4), (3,4)}

## 连通性引理

**引理**: 设 A 是具有 n 个元素的集合，R 是 A 上的关系。如果存在从 a 到 b 的路径且 a ≠ b，那么存在长度 ≤ n-1 的路径。

**证明** (通过直觉)
- 如果路径没有循环，我们最多可以访问 n 个不同的元素
- 循环可能会增加长度但同一节点被访问多次

## 连通性引理

**引理**: 设 A 是具有 n 个元素的集合，R 是 A 上的关系。如果存在从 a 到 b 的路径且 a ≠ b，那么存在长度 ≤ n-1 的路径。
R* = ⋃ₖ₌₁ⁿ Rᵏ

**定理**: 关系 R 的传递闭包等于连通性关系 R*

## Warshall 算法

**过程** Warshall(M_R: n×n 零一矩阵)
// 使用零一矩阵计算 R*
W := M_R;
对于 k := 1 到 n
    对于 i := 1 到 n
        对于 j := 1 到 n
            w_ij := w_ij ∨ (w_ik ∧ w_kj)
返回 W // W 是 R* 的零一矩阵

w_ij = 1 表示存在从 i 到 j 的路径，仅通过节点 ≤ k。
W[k]_ij = W[k-1]_ij ∨ (W[k-1]_ik ∧ W[k-1]_kj)

该算法需要 Θ(n³) 时间。

## 示例

找到矩阵 W⁰, W¹, W², W³, 和 W⁴。矩阵 W⁴ 是 R 的传递闭包。
设 v₁ = a, v₂ = b, v₃ = c, v₄ = d。

W⁰ = 
```
0 0 0 0
1 0 1 0
0 0 0 1
0 0 0 0
```

W¹ = W² = 
```
0 0 0 0
1 0 1 0
0 0 0 1
0 0 0 0
```

W³ = 
```
0 0 0 0
1 0 1 1
0 0 0 1
0 0 0 0
```

W⁴ = 
```
1 0 1 1
1 0 1 1
0 0 0 1
0 0 0 0
```

## 等价关系

**定义** 集合 A 上的关系 R 称为等价关系，如果它是自反的、对称的和传递的。

**示例**: A = {0,1,2,3,4,5,6} R = {(a,b): a ≡ b mod 3}
R 具有以下对：
- (0,0), (0,3), (3,0), (0,6), (6,0), (3,3), (3,6), (6,3), (6,6)
- (1,1), (1,4), (4,1), (4,4)
- (2,2), (2,5), (5,2), (5,5)

## 等价关系

关系 R 在 A = {0,1,2,3,4,5,6} 上具有对：
- (0,0), (0,3), (3,0), (0,6), (6,0), (3,3), (3,6), (6,3), (6,6)
- (1,1), (1,4), (4,1), (4,4)
- (2,2), (2,5), (5,2), (5,5)

R 是自反的吗？ ✓
R 是对称的吗？ ✓
R 是传递的吗？ ✓
R 是等价关系。

## 等价关系示例

**示例**
"字符串 a 和 b 具有相同的长度。"
"整数 a 和 b 具有相同的绝对值。"
"实数 a 和 b 具有相同的小数部分（即 a - b ∈ Z）。"
"实数之间的 ≤ 关系。" ✗
"自然数之间具有大于 1 的公因子。" ✗

## 等价类

**定义** 设 R 是集合 A 上的等价关系。与 A 的元素 a 相关的所有元素的集合称为 a 的等价类，记作 [a]_R。当只考虑一个关系时，我们使用符号 [a]。

[a]_R = {b: (a,b) ∈ R}

A = {0,1,2,3,4,5,6} R = {(a,b): a ≡ b mod 3}
[0] = [3] = [6] = {0,3,6}
[1] = [4] = {1,4}
[2] = [5] = {2,5}

## 等价类示例

**示例**
"字符串 a 和 b 具有相同的长度。"
[a] = 与 a 长度相同的所有字符串的集合
"整数 a 和 b 具有相同的绝对值。"
[a] = 集合 {a, -a}
"实数 a 和 b 具有相同的小数部分（即 a - b ∈ Z）。"
[a] = 集合 {..., a-2, a-1, a, a+1, a+2, ...}

## 等价类定理

**定理** 设 R 是集合 A 上的等价关系。以下陈述是等价的：
(i) aRb
(ii) [a] = [b]
(iii) [a] ∩ [b] ≠ ∅

**证明**
(i) → (ii): 证明 [a] ⊆ [b] 且 [b] ⊆ [a]
(ii) → (iii): [a] 非空（R 自反）
(iii) → (i): 存在 c 使得 c ∈ [a] 且 c ∈ [b]

## 集合 S 的划分

**定义** 设 S 是一个集合。S 的非空子集 A₁, A₂, ..., Aₖ 的集合称为 S 的划分，如果：
Aᵢ ∩ Aⱼ = ∅, i ≠ j 且 S = ⋃ᵢ₌₁ᵏ Aᵢ

## 集合 S 的划分

**定义** 设 S 是一个集合。S 的非空子集 A₁, A₂, ..., Aₖ 的集合称为 S 的划分，如果：
Aᵢ ∩ Aⱼ = ∅, i ≠ j 且 S = ⋃ᵢ₌₁ᵏ Aᵢ

**示例**: A = {0,1,2,3,4,5,6}
A₁ = {0,3,6}, A₂ = {1,4}, A₃ = {2,5}
A₁, A₂, A₃ 是 S 的划分吗？ ✓

## 等价类和划分

**定理** 设 R 是集合 A 上的等价关系。那么 R 的所有等价类的并集是 A：
A = ⋃ₐ∈ₐ [a]_R

**定理** 等价类形成 A 的划分。

**定理** 设 {A₁, A₂, ..., Aᵢ, ...} 是 S 的划分。那么存在 S 上的等价关系 R，以集合 Aᵢ 作为其等价类。

## 下节课内容
- 关系，图

## 相关知识点总结
- [[图论与关系]] - 图论与关系知识分块总结
- [[离散数学总览]] - 离散数学整体概述
